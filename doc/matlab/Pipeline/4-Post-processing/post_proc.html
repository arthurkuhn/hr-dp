<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of post_proc</title>
  <meta name="keywords" content="post_proc">
  <meta name="description" content="% Noise Anomaly Detection %%">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- # matlab --><!-- # Pipeline --><!-- menu.html 4-Post-processing -->
<h1>post_proc
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>% Noise Anomaly Detection %%</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [array_post, noisy_sig_post, std_post, diff_sig] = post_proc(detrended, sig, BPM, R_loc, fs, mfilt_size) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">% Noise Anomaly Detection %%</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../matlab/Pipeline/Runners/runner.html" class="code" title="">runner</a>	</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%% Noise Anomaly Detection %%</span>
0002 <a name="_sub0" href="#_subfunctions" class="code">function [array_post, noisy_sig_post, std_post, diff_sig] = post_proc(detrended, sig, BPM, R_loc, fs, mfilt_size)</a>
0003 
0004 
0005 <span class="comment">% prev out</span>
0006 <span class="comment">% [array_post, noisy_sig_post, std_post, diff_sig]</span>
0007 time = 0:(1/fs):((length(sig)-1)/fs);
0008 plot_graph = 1;
0009 <span class="comment">%median filter</span>
0010 <span class="comment">%mfilt_size = 15;</span>
0011 <span class="comment">%std dev</span>
0012 window = 10;
0013 threshold = 4;
0014 
0015 <span class="comment">%median filter</span>
0016 mfilt_sig = medfilt1(BPM,mfilt_size);
0017 <span class="comment">%std dev filter</span>
0018 [array_post,noisy_sig_post,std_post] = std_dev(mfilt_sig, window, threshold);
0019 
0020 <span class="keyword">if</span> (plot_graph == 1)
0021     figure;
0022     bx1 = subplot(3,1,1);
0023     hold on;
0024     plot (time,detrended);
0025     plot(time(R_loc),detrended(R_loc),<span class="string">'rv'</span>,<span class="string">'MarkerFaceColor'</span>,<span class="string">'r'</span>)
0026     legend(<span class="string">'ECG'</span>,<span class="string">'R'</span>);
0027     title(<span class="string">'ECG Signal with R points'</span>);
0028     xlabel(<span class="string">'Time in seconds'</span>);
0029     ylabel(<span class="string">'Amplitude'</span>);
0030     
0031     <span class="comment">%     figure;</span>
0032     <span class="comment">%     %plot BPM</span>
0033     <span class="comment">%     bx1 = subplot(3,1,1);</span>
0034     <span class="comment">%     plot(time(R_loc), BPM);</span>
0035     <span class="comment">%     title(&quot;Kota BPM&quot;);</span>
0036     <span class="comment">%     xlabel(&quot;Time (s)&quot;);</span>
0037     <span class="comment">%     ylabel(&quot;BPM&quot;);</span>
0038     <span class="comment">%     ylim([0 300]);</span>
0039     <span class="comment">%axis([0 (1.05*length(time(R_loc))) 0 300]);</span>
0040     <span class="comment">%median filtered</span>
0041     
0042     bx2 = subplot(3,1,2);
0043     f=fit(transpose(time(R_loc)),transpose(BPM),<span class="string">'smoothingspline'</span>);
0044     plot(f,time(R_loc),interval);
0045     <span class="comment">%plot(1:length(mfilt_sig), mfilt_sig);</span>
0046     title(&quot;BPM Arthur&quot;);
0047     <span class="comment">%title(&quot;BPM after 5 sample median filter&quot;);</span>
0048     xlabel(&quot;Time (s)&quot;);
0049     ylabel(&quot;BPM&quot;);
0050     <span class="comment">%axis([0 (1.05*length(BPM)) 0 200]);</span>
0051     ylim([50 250]);
0052     <span class="comment">%axis([0 (1.05*length(time(R_loc))) 0 300]);</span>
0053     
0054     
0055     
0056     <span class="comment">%noise</span>
0057     bx3 = subplot(3,1,3);
0058     plot(time(R_loc),mfilt_sig);
0059     hold on
0060     <span class="comment">%plot(array_pt, noisy_sig_pt, 'rv');</span>
0061     scatter(time(R_loc(array_post)), noisy_sig_post,15, <span class="string">'r'</span>);
0062     title(&quot;Std Dev Noise detection with threshold = &quot;+ threshold + &quot; and window size = &quot;+ mfilt_size);
0063     xlabel(&quot;Time (s)&quot;);
0064     ylabel(&quot;BPM&quot;);
0065     <span class="comment">%axis([0 (1.05*length(BPM)) 0 200]);</span>
0066     ylim([0 300]);
0067     <span class="comment">%axis([0 (1.05*length(time(R_loc))) 0 300]);</span>
0068     
0069     linkaxes([bx1,bx2, bx3],<span class="string">'x'</span>);
0070     
0071     diff_sig = diff(std_post);
0072     diff_sig(length(diff_sig)+1)=0;
0073     figure;
0074     subplot(3, 1, 1);
0075     plot(time(R_loc),mfilt_sig);
0076     hold on
0077     <span class="comment">%plot(array_pt, noisy_sig_pt, 'rv');</span>
0078     scatter(time(R_loc(array_post)), noisy_sig_post,15, <span class="string">'r'</span>);
0079     title(&quot;Std Dev Noise detection with threshold = &quot;+ threshold + &quot; and window size = &quot;+ mfilt_size);
0080     xlabel(&quot;Time (s)&quot;);
0081     ylabel(&quot;BPM&quot;);
0082     <span class="comment">%axis([0 (1.05*length(BPM)) 0 200]);</span>
0083     ylim([0 300]);
0084     <span class="comment">%axis([0 (1.05*length(time(R_loc))) 0 300]);</span>
0085     
0086     subplot(3, 1, 2);
0087     plot(time(R_loc), std_post);
0088     
0089     subplot(3, 1, 3);
0090     plot(time(R_loc), diff_sig);
0091 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Fri 02-Feb-2018 18:15:25 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>