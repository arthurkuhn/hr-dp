<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of hrvDetect</title>
  <meta name="keywords" content="hrvDetect">
  <meta name="description" content="RUNHRVANALYSIS Summary of this function goes here">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../menu.html completeToolbox --><!-- menu.html Pipeline -->
<h1>hrvDetect
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>RUNHRVANALYSIS Summary of this function goes here</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function [ result ] = hrvDetect( params ) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">RUNHRVANALYSIS Summary of this function goes here
   Detailed explanation goes here</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="ensembleNonCorrelatedDetector.html" class="code" title="function nonCorrelated = ensembleNonCorrelatedDetector( detrended_sig, R_locs, minCorrelation, windowSize )">ensembleNonCorrelatedDetector</a>	ENSEMBLEOUTLIERDETECTOR Summary of this function goes here</li><li><a href="kota.html" class="code" title="function [ R_loc ] = kota( sig, detrended, fs )">kota</a>	kota QRS detection using Hilbert Transform</li><li><a href="loadFromFile.html" class="code" title="function [ sig, fs ] = loadFromFile( file )">loadFromFile</a>	LOADFROMFILE Loads the ECG signal from the full APEX recording file</li><li><a href="medFilter.html" class="code" title="function outliers = medFilter( s, tau )">medFilter</a>	medFilter Finds the outliers in the signal using a median filter</li><li><a href="missedBeatDetector.html" class="code" title="function errors = missedBeatDetector( interval, toleratedeviationPercent )">missedBeatDetector</a>	MISSEDBEATDETECTOR Summary of this function goes here</li><li><a href="preprocessingNew.html" class="code" title="function [ sig, detrended ] = preprocessingNew(sig, fs)">preprocessingNew</a>	preprocessingNew Pre-processing of ECG signal</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../completeToolbox/Physionet/evaluator.html" class="code" title="">evaluator</a>	</li><li><a href="../../completeToolbox/fullRunner.html" class="code" title="">fullRunner</a>	</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [ result ] = hrvDetect( params )</a>
0002 <span class="comment">%RUNHRVANALYSIS Summary of this function goes here</span>
0003 <span class="comment">%   Detailed explanation goes here</span>
0004 
0005 <span class="comment">% Ensemble Filter Window Size:</span>
0006 ensembleFilterWindowSize = 200; <span class="comment">% in ms</span>
0007 smoothingSplinesCoefficient = 0.5; <span class="comment">% between 0 and 1</span>
0008 
0009 <span class="comment">% Load Sig</span>
0010 [ sig, fs ] = <a href="loadFromFile.html" class="code" title="function [ sig, fs ] = loadFromFile( file )">loadFromFile</a>( params.ecgFile );
0011 
0012 <span class="comment">% Pre-processing</span>
0013 [ sig, detrended ] = <a href="preprocessingNew.html" class="code" title="function [ sig, detrended ] = preprocessingNew(sig, fs)">preprocessingNew</a>(sig, fs);
0014 
0015 <span class="comment">% Kota</span>
0016 [ R_locs ] = <a href="kota.html" class="code" title="function [ R_loc ] = kota( sig, detrended, fs )">kota</a>(sig, detrended, fs);
0017 
0018 <span class="keyword">if</span>(params.postProcessing.ensembleFilter.isOn == 1)
0019     errors = <a href="ensembleNonCorrelatedDetector.html" class="code" title="function nonCorrelated = ensembleNonCorrelatedDetector( detrended_sig, R_locs, minCorrelation, windowSize )">ensembleNonCorrelatedDetector</a>( detrended, R_locs, params.postProcessing.ensembleFilter.threshold, ensembleFilterWindowSize );
0020 <span class="keyword">else</span>
0021     errors = zeros(1,length(R_locs));
0022 <span class="keyword">end</span>
0023 
0024 
0025 <span class="comment">% Make the interval array with the valid beats</span>
0026 interval = diff(R_locs);
0027 noisy = zeros(1,length(interval));
0028 <span class="keyword">for</span> i = 1:length(R_locs)-1
0029     <span class="comment">% Since here interval(i) = R_locs(i+1)-R_locs(i)</span>
0030     <span class="keyword">if</span>(errors(i) == 1)
0031         <span class="keyword">if</span>(i &gt; 1)
0032             noisy(i-1) = 1;
0033             noisy(i) = 1;
0034         <span class="keyword">else</span>
0035             noisy(i) = 1;
0036         <span class="keyword">end</span>
0037     <span class="keyword">end</span>
0038 <span class="keyword">end</span>
0039 
0040 <span class="comment">% Check for missed beat signs</span>
0041 
0042 <span class="keyword">if</span>(params.postProcessing.missedBeats.isOn == 1)
0043     missedBeatErrors = <a href="missedBeatDetector.html" class="code" title="function errors = missedBeatDetector( interval, toleratedeviationPercent )">missedBeatDetector</a>( interval, params.postProcessing.missedBeats.threshold );
0044 <span class="keyword">else</span> 
0045     missedBeatErrors = zeros(1, length(interval));
0046 <span class="keyword">end</span>
0047 
0048 <span class="comment">% Use the non-destructive median filter:</span>
0049 <span class="keyword">if</span>(params.postProcessing.madFilter.isOn == 1)
0050     outliers = <a href="medFilter.html" class="code" title="function outliers = medFilter( s, tau )">medFilter</a>( interval, params.postProcessing.madFilter.threshold );
0051 <span class="keyword">else</span> 
0052     outliers = zeros(1, length(interval));
0053 <span class="keyword">end</span>
0054 
0055 totalNoisyIntervals = noisy | missedBeatErrors | outliers;
0056 
0057 noisyIntervals = logical(totalNoisyIntervals);
0058 
0059 BPM = 60*fs./(interval);
0060 intervalLocs = R_locs(1:end-1);
0061 time = 0:(1/fs):((length(detrended)-1)/fs);
0062 <span class="keyword">switch</span> (params.tachoProcessing.interpolationMethod)
0063       <span class="keyword">case</span> <span class="string">'spline'</span>
0064           f = fit(transpose(time(intervalLocs(~noisyIntervals))),transpose(BPM(~noisyIntervals)),<span class="string">'smoothingspline'</span>,<span class="string">'SmoothingParam'</span>,smoothingSplinesCoefficient);
0065           smoothSignal = f(time(intervalLocs(~noisyIntervals)));
0066       <span class="keyword">case</span> <span class="string">'direct'</span>
0067           smoothSignal = BPM(~noisyIntervals);
0068 <span class="keyword">end</span>
0069 <span class="keyword">if</span>(params.tachoProcessing.medianFilter.isOn == 1)
0070     smoothSignal = medfilt1(smoothSignal,params.tachoProcessing.medianFilter.windowSize);
0071 <span class="keyword">end</span>
0072 
0073 percentNoisy = sum(noisyIntervals) / ( length(R_locs)-1 ) * 100;
0074 <span class="keyword">switch</span> (params.tachoProcessing.interpolationMethod)
0075     <span class="keyword">case</span> <span class="string">'spline'</span>
0076         [~,gof,~] = fit(transpose(time(intervalLocs(~noisyIntervals))),transpose(BPM(~noisyIntervals)),<span class="string">'smoothingspline'</span>,<span class="string">'SmoothingParam'</span>,smoothingSplinesCoefficient);
0077         r_squarred = gof.rsquare;
0078     <span class="keyword">case</span> <span class="string">'direct'</span>
0079         r_squarred = 0;
0080 <span class="keyword">end</span>
0081 
0082 result = {};
0083 result.fs = fs;
0084 result.tachogram = interval;
0085 result.R_locs = R_locs;
0086 result.heartRate = smoothSignal;
0087 result.cleanIntervals = intervalLocs(~noisyIntervals);
0088 result.interpolatedFlag = [0];
0089 result.evaluation = struct(<span class="string">'totalNumBeats'</span>, length(R_locs),<span class="string">'percentInvalid'</span>, percentNoisy,<span class="string">'splineRSquare'</span>, r_squarred);
0090 
0091 <span class="keyword">end</span>
0092</pre></div>
<hr><address>Generated on Wed 14-Mar-2018 09:58:43 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>